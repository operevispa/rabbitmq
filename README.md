# RabbitMQ. ДЗ-1 Бизнес применение ML
Использование RabbitMQ в качестве брокера сообщений в проекте с 4мя микросервисами.

## Описание микросервисов
- Сервис 1 (features): Сервис рандомно получает признаки и истинные ответ из датасета о диабете и отправляет признаки в очередь features, a истинное значение в очередь сообщений y_true. Также отправляется нотификация в отдельную очередь notification, для обновления гистограммы. Истинное значение отправляется через некоторое время после отправки в очередь признаков (используется два таймслипа)
- Сервис 2 (model): Загружает обученную модель, забирает из очереди признаки, делает предикт и полученное значение отправляет в очередь y_pred
- Сервис 3 (metric): Забирает из очередей истинное значение и спрогнозированное моделью, с помощью словаря по ключу (которым выступает id сообщения, сформированное из timestamp) проверяет пару и если пара найдена, считает абсолютное отклонение. Далее данные (`id`,`y_true`,`y_pred`,`absolute_error`) записываются в файл `metric_log.csv`
- Сервис 4 (plot): При получении нотификации о том, что прошел очередной цикл отправки признаков и целевой переменной, актуализирует гистограмму. Также реализован второй вариант - обновление гистограммы по времени (с таймслип в размере двух ожиданий сервисе features), в вечном цикле

## Описание реализации
Каждый сервис помещен в отдельный docker container. Сервисы "общаются" между собой через брокер сообщений, а сервис plot формирует гистограмму ошибок на основании данных из csv файла, который формируется сервисом metric. Для этого настроены volume через папку logs. Эта же папка связана с хостовой машиной и папкой logs для просмотра формирующегося log-файла и гистограммы error_distribution.png

Каждый сервис имеет свой файл с зависимостями `requirements.txt`.

Запуск сервисов происходит с помощью docker-compose. При этом сервис rabbitmq запускается первым и пока он не вернет статус service_healthy, другие контейнеры не запускаются.

Для запуска всех микросервисов достаточно скачать файлы с github и запустить одну команду
```bash
docker-compose up -d --build
```

В папку screenshots положил несколько скриншотов с результатами работы сервисов.
